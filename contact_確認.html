<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>フォーム - デモ</title>
  <link rel="stylesheet" href="./css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

  <div class="content">
    <section class="contact_main">
      <div class="progress_container">
        <div class="progress_bar">
          <div class="progress_circle input active"></div>
          <div class="progress_circle_line"></div>
          <div class="progress_circle confirm"></div>
          <div class="progress_circle_line"></div>
          <div class="progress_circle complete"></div>
        </div>
        <div class="progress_labels">
          <span class="progress_label input active">お問い合わせ入力</span>
          <span class="progress_label confirm">お問い合わせ確認</span>
          <span class="progress_label complete">お問い合わせ完了</span>
        </div>
      </div>

      <!-- 問い合わせ入力画面 -->
      <form class="input_form">
        <div class="form_group">
          <label for="name" class="contact_label">お名前</label>
          <input type="text" id="name" name="name" placeholder="田中　太郎" required>
        </div>
        <div class="form_group">
          <label for="email" class="contact_label">メールアドレス</label>
          <input type="email" id="email" name="email" placeholder="example@example.com" required>
        </div>
        <div class="form_group">
          <label for="message" class="contact_label">お問い合わせ内容</label>
          <textarea id="message" name="message" rows="5" placeholder="お問い合わせ内容をご記入ください" required></textarea>
        </div>
        <div class="form-group">
          <button type="submit" class="button_morning contact_button">確認</button>
        </div>
      </form>


      <!-- 問い合わせ内容確認画面 -->
      <form class="confirm_form"
        action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSd792Ymm05HcGJuqhnSlxTM9HPv_ZOWrpw7HJFpTFbyplvv1g/formResponse"
        method="post" target="hidden_iframe" onsubmit="submitted=true;">
        <div class="form_group">
          <label for="name" class="contact_label">お名前</label>
          <input type="text" id="name" name="entry.1137286494" readonly>
        </div>
        <div class="form_group">
          <label for="email" class="contact_label">メールアドレス</label>
          <input type="email" id="email" name="entry.2092419904" readonly>
        </div>
        <div class="form_group message">
          <label for="message" class="contact_label">お問い合わせ内容</label>
          <textarea id="message" name="entry.1905298872" readonly></textarea>
        </div>
        <div class="form-group button_wrap">
          <button type="button" class="button_morning contact_button fix_button">修正</button>
          <button type="submit" class="button_morning contact_button">送信</button>
        </div>
      </form>

      <!-- サンクスページ -->
      <div class="completed_form">
        <p>
          この度はご連絡いただき誠にありがとうございます。<br>
          送信内容を確認させていただき、追ってご返信いたします。
        </p>
      </div>
    </section>
  </div>

  <script type="text/javascript">
    let submitted = false;
  </script>
  <iframe name="hidden_iframe" id="hidden_iframe" style="display: none" onload="
    if(submitted){
      $('.confirm_form').hide()
      $('.completed_form').show()

      $('.progress_circle.confirm').removeClass('active')
      $('.progress_label.confirm').removeClass('active')
      $('.progress_circle.complete').addClass('active')
      $('.progress_label.complete').addClass('active')
    }
  "></iframe>


  <script>
    $(function () {
      $('.input_form').on('submit', function (event) {
        event.preventDefault()

        // 入力された内容を取得
        let type = $('.input_form input[name="inquiry_type"]:checked').val()
        let name = $('.input_form input[name="name"]').val()
        let mail = $('.input_form input[name="email"]').val()
        let tell = $('.input_form input[name="phone"]').val()
        let message = $('.input_form textarea[name="message"]').val()

        if (type && name && mail && tell && message) {
          // 入力フォームを非表示
          $('.input_form').hide()
          // 確認画面を表示
          $('.confirm_form').show()

          // プログレスバー
          $('.progress_circle.input').removeClass('active')
          $('.progress_label.input').removeClass('active')
          $('.progress_circle.confirm').addClass('active')
          $('.progress_label.confirm').addClass('active')

          // 入力された内容を挿入
          $('.confirm_form #request').val(type)
          $('.confirm_form #name').val(name)
          $('.confirm_form #email').val(mail)
          $('.confirm_form #phone').val(tell)
          $('.confirm_form #message').val(message)

          // 修正ボタンが押された時
          $('.fix_button').on('click', function () {
            // 入力画面を表示
            $('.input_form').show()
            // 確認画面を非表示
            $('.confirm_form').hide()

            // プログレスバー
            $('.progress_circle.input').addClass('active')
            $('.progress_label.input').addClass('active')
            $('.progress_circle.confirm').removeClass('active')
            $('.progress_label.confirm').removeClass('active')
          })
        }
      })
    })
  </script>
</body>

</html>